# âš™ï¸ Internal Directory

The **internal** directory contains the **foundational components** of Electrician. These packages **power the frameworkâ€™s core functionality**, enabling structured concurrency, event-driven pipelines, data transformation, and microservice communication.

These packages are **not** intended for direct use by end users. Instead, they provide **infrastructure** that Electricianâ€™s higher-level APIs (such as `pkg/builder`) use to construct pipelines, enforce reliability mechanisms, and manage performance.

---

## ğŸ“¦ Package Overview

Each package within `internal/` has a **specific role** in the Electrician ecosystem. Below is a breakdown of all internal packages and their responsibilities.

| Package             | Description                                                                                                 |
| ------------------- | ----------------------------------------------------------------------------------------------------------- |
| **adapter/**        | Connects external systems via **HTTP, OAuth2, or other data sources**.                                      |
| **circuitbreaker/** | Implements **failure detection and recovery**, including automatic reset logic.                             |
| **codec/**          | Handles **serialization and deserialization** of data within pipelines.                                     |
| **conduit/**        | Manages **multi-stage processing** by linking multiple Wires together.                                      |
| **forwardrelay/**   | **Sends** data streams to external services via gRPC (outgoing messages).                                   |
| **generator/**      | Produces **autonomous data feeds** for a pipeline, such as synthetic test data.                             |
| **internallogger/** | Centralized **structured logging** for internal components (**only non-standard dependency: `zap`**).       |
| **meter/**          | Measures **performance metrics**, tracking throughput, errors, and concurrency statistics.                  |
| **plug/**           | Defines **pluggable data sources** (like adapters), allowing dynamic integration of new input sources.      |
| **receivingrelay/** | **Receives** and decodes incoming gRPC streams, integrating external data into pipelines.                   |
| **relay/**          | Contains **compiled Protobuf gRPC** code for Electricianâ€™s inter-service communication (**uses protobuf**). |
| **resister/**       | Implements **queue-based rate limiting** for controlled message delivery.                                   |
| **sensor/**         | Monitors system behavior, collecting **real-time telemetry** for debugging and analytics.                   |
| **surgeprotector/** | Protects pipelines from **overload**, rerouting or pausing traffic when thresholds are exceeded.            |
| **types/**          | **Source of truth** for all shared interfaces and contracts in Electrician.                                 |
| **utils/**          | Contains **internal utilities** (e.g., functors, common helpers).                                           |
| **wire/**           | The **core processing unit** of Electrician, handling data flow, transformation, and lifecycle management.  |

---

## ğŸ“‚ Package Structure

Each internal package follows a **consistent structure** designed for **maintainability and scalability**.

| File Name           | Purpose                                                          |
| ------------------- | ---------------------------------------------------------------- |
| **api.go**          | Public API for this package (**internal to Electrician only**).  |
| **internal.go**     | Private helper functions, **only used within the package**.      |
| **notify.go**       | Handles **logging, telemetry, and event notifications**.         |
| **options.go**      | Provides **functional options** for configuring components.      |
| **package.go**      | Defines the **type and constructor** for the component.          |
| **package_test.go** | Unit/integration tests ensuring **correctness and reliability**. |

### âœ¨ **Why This Structure?**

âœ”ï¸ **Separation of Concerns** â€“ Public API (`api.go`) is distinct from internal logic (`internal.go`).  
âœ”ï¸ **Composability** â€“ Configuration via **functional options (`options.go`)** or direct method calls.  
âœ”ï¸ **Event-Driven Architecture** â€“ `notify.go` ensures **consistent logging and telemetry** across the framework.  
âœ”ï¸ **Reliability** â€“ Every package includes **unit tests (`package_test.go`)** for guaranteed stability.

---

## ğŸš€ Design Philosophy

Electrician follows a **strict immutability model**:  
ğŸ”´ **Runtime modifications to components are not supported.**  
âœ”ï¸ **Pipelines should be fully configured before execution.**

This ensures:

- **Predictability** â€“ Pipelines behave consistently without unexpected state changes.
- **Concurrency Safety** â€“ Eliminates race conditions and synchronization issues.
- **Performance Optimization** â€“ Avoids costly reconfiguration overhead.

While Go technically allows modifying running components, **Electrician strongly discourages this**. The framework is designed for **deterministic, event-driven pipelines** that are pre-configured and stable.

---

## ğŸ”§ Extending Internal Packages

To **add new functionality**, follow this **strict contract**:

1ï¸âƒ£ **Modify `types/`**

- All public functionality starts by **adding an interface method** to `types/package.go`.
- This ensures **consistent contracts** across components.

2ï¸âƒ£ **Implement in `api.go`**

- Add the **actual implementation** of the new method.

3ï¸âƒ£ **Create a Functional Option in `options.go`**

- Supports **composable, declarative-style configuration**.

4ï¸âƒ£ **Enhance `notify.go` (if applicable)**

- If your change introduces **new events**, add corresponding **logging and telemetry hooks**.

5ï¸âƒ£ **Update Tests (`package_test.go`)**

- Ensure **full test coverage** before merging.

By enforcing these steps, Electrician maintains **consistency, safety, and extensibility**.

---

## ğŸ—ï¸ Relationship to `pkg/builder`

- **End users never interact with `internal/` directly**â€”they use `pkg/builder`, which acts as the **public API**.
- **The `builder/` package is a wrapper** that applies functional options and calls the appropriate internal components.
- The **internal directory is effectively the "engine" of Electrician**, while `builder/` provides a user-friendly interface.

---

## âš¡ Standard Library First

Electrician is **99% based on the Go standard library**.  
The **only** external dependencies used in `internal/` are:

- **`zap` (Uberâ€™s logging library)** â€“ Used in `internallogger/`, as itâ€™s the **fastest and most structured** logging system in Go.
- **`protobuf` (gRPC and serialization)** â€“ Used in `relay/`, since Electrician supports **cross-service messaging**.

Everything elseâ€”including **networking, data transformation, and concurrency management**â€”is built using **pure Go**, ensuring:

âœ… **Maximum compatibility** â€“ No unnecessary dependencies.  
âœ… **Minimal attack surface** â€“ Secure and easy to audit.  
âœ… **High performance** â€“ Optimized for **low-latency, high-throughput pipelines**.

---

## ğŸ“– Further Reading

- **[Root README](../../../README.md)** â€“ Electricianâ€™s overall architecture and principles.
- **[Per-Package README]** â€“ Each internal sub-package (`wire`, `circuitbreaker`, etc.) contains additional details.
- **[Examples Directory](../../../example/)** â€“ Demonstrates these internal components in real-world use cases.

---

## ğŸ“ License

All internal packages fall under Electricianâ€™s [Apache 2.0 License](../../../LICENSE).  
You are free to use, modify, and distribute them under these terms, but note that **they are not designed for direct external use**.

---

## âš¡ Happy wiring! ğŸš€

If you have any questions or need clarification, feel free to **open a GitHub issue**.
