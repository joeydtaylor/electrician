# ğŸ—ï¸ Builder Package

The `builder` package is Electricianâ€™s **public construction layer**.

It provides ergonomic constructors (`NewWire`, `NewConduit`, `NewRelay`, etc.) plus a consistent set of **functional options** (`WireWithâ€¦`, `ConduitWithâ€¦`, â€¦) so you can assemble pipelines without reaching into implementation details.

Under the hood, `builder` wraps the engine in `pkg/internal/*`.

---

## ğŸ”’ Import boundary

Electrician uses a â€œpublic surface + private engineâ€ layout:

* `pkg/builder` is intended for consumers of the module.
* `pkg/internal/*` is private to `pkg/*` (enforced by Goâ€™s `internal/` rule).

Practically:

* âœ… packages under `pkg/` can import `pkg/internal/...`
* âŒ external consumers cannot import `pkg/internal/...`

So `builder` is where the stable, user-facing API lives.

---

## ğŸ“¦ What builder does

* ğŸ§± **Constructs components** with sane defaults.
* ğŸ§© **Applies options** consistently (configuration-time wiring).
* ğŸ” **Keeps internal packages swappable** (internal implementations can evolve without forcing API churn).

`builder` is intentionally thin: it should not add runtime overhead to the hot path.

---

## âš™ï¸ Functional options

Electricianâ€™s public API uses the functional options pattern to keep constructors clean and composable.

Example (Wire):

```go
w := builder.NewWire[string](
    ctx,
    builder.WireWithConcurrencyControl[string](1024, 8),
    builder.WireWithTransformer[string](func(v string) (string, error) {
        return strings.ToUpper(v), nil
    }),
    builder.WireWithCircuitBreaker[string](cb),
    builder.WireWithSurgeProtector[string](sp),
    builder.WireWithSensor[string](sensor),
)
```

Notes:

* Options are meant to be applied **before** `Start()`.
* Configuration mutation while running is not supported.

---

## ğŸ§  How builder maps to internal

The pattern is consistent across components:

1. `builder.NewX(...)` delegates to `pkg/internal/x.NewX(...)`.
2. `builder.XWithY(...)` options call the underlying componentâ€™s connect/set method.
3. The returned value is a ready-to-start component implementing the shared `types` contract.

This gives you:

* stable constructors
* predictable option naming
* internal flexibility without exposing internals

---

## ğŸ“‚ Package layout

Builder exposes one file per component family (names may vary as the repo evolves, but the idea holds):

| File                | Responsibility                                |
| ------------------- | --------------------------------------------- |
| `wire.go`           | Wire constructor + Wire options (`WireWithâ€¦`) |
| `conduit.go`        | Conduit constructor + options                 |
| `circuitbreaker.go` | Circuit breaker constructor + options         |
| `surgeprotector.go` | Surge protector constructor + options         |
| `resister.go`       | Resister/queue wiring + options               |
| `sensor.go`         | Sensor constructor + options                  |
| `meter.go`          | Meter constructor + options                   |
| `logger.go`         | Logger constructors/adapters + options        |
| `codec.go`          | Encoder/decoder helpers + options             |
| `adapter.go`        | Integration adapters (HTTP, auth, etc.)       |
| `forwardrelay.go`   | Outbound relay constructors/options           |
| `receivingrelay.go` | Inbound relay constructors/options            |
| `plug.go`           | Plug constructors/options                     |
| `generator.go`      | Generator constructors/options                |

---

## ğŸš„ Performance stance

Builder is configuration-time glue. The performance characteristics of a running pipeline are dominated by the internal engine (especially `wire`).

If youâ€™re optimizing throughput:

* keep the hot path minimal (transform + emit)
* keep telemetry and encoding opt-in
* prefer worker-local state (factory transforms / scratch buffers) over shared pooling unless measured

---

## ğŸ”§ Extending builder

When you add a capability, keep the layering clean:

1. Add/extend the contract in `pkg/internal/types` (if itâ€™s cross-component).
2. Implement it in the relevant `pkg/internal/*` component.
3. Expose it through `pkg/builder` via:

   * a constructor update (if needed), and/or
   * a new `XWithâ€¦` option.

The goal is for consumers to never need to touch `pkg/internal/*`.

---

## ğŸ“– Further Reading

- **[Root README](../../README.md)** â€“ Electricianâ€™s overall architecture and principles.
- **[Internal README](../internal/README.md)** â€“ In-depth explanation of how the `internal/` directory works.
- **[Examples Directory](../../example/)** â€“ Real-world use cases demonstrating the builder API in action.

---

## ğŸ“ License

The **builder package** is part of Electrician and is released under the [Apache 2.0 License](../../LICENSE).  
Youâ€™re free to use, modify, and distribute it within these terms.

---

**Happy wiring! âš™ï¸ğŸš€** If you have questions or need support, feel free to open a GitHub issue.
